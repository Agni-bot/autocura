<!DOCTYPE html>
<html>
<head>
    <title>Teste API SugestÃµes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #2a5298;
            color: white;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: rgba(255,255,255,0.1);
        }
        .success { border-left: 5px solid #4CAF50; }
        .error { border-left: 5px solid #F44336; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
        }
        #suggestions {
            margin-top: 20px;
        }
        .suggestion {
            background: rgba(255,255,255,0.1);
            margin: 10px 0;
            padding: 15px;
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Teste da API de SugestÃµes</h1>
    
    <button onclick="testAPI()">ğŸ” Testar ConexÃ£o API</button>
    <button onclick="loadSuggestions()">ğŸ“‹ Carregar SugestÃµes</button>
    <button onclick="testApply()">âœ… Testar AplicaÃ§Ã£o</button>
    <button onclick="testPreview()">ğŸ‘ï¸ Testar Preview</button>
    
    <div id="results"></div>
    <div id="suggestions"></div>
    
    <script>
        function addResult(message, success = true) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `test-result ${success ? 'success' : 'error'}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            results.appendChild(div);
        }
        
        async function testAPI() {
            addResult('ğŸ”„ Testando conexÃ£o com API...');
            
            try {
                const response = await fetch('http://localhost:8001/evolution/suggestions');
                if (response.ok) {
                    addResult('âœ… API estÃ¡ respondendo!', true);
                    const data = await response.json();
                    addResult(`ğŸ“Š Encontradas ${data.suggestions?.length || 0} sugestÃµes`, true);
                } else {
                    addResult(`âŒ API retornou erro: ${response.status}`, false);
                }
            } catch (error) {
                addResult(`âŒ Erro de conexÃ£o: ${error.message}`, false);
                addResult('ğŸ’¡ Certifique-se que python api_sugestoes.py estÃ¡ rodando', false);
            }
        }
        
        async function loadSuggestions() {
            addResult('ğŸ“‹ Carregando sugestÃµes...');
            
            try {
                const response = await fetch('http://localhost:8001/evolution/suggestions');
                const data = await response.json();
                
                if (data.success) {
                    const container = document.getElementById('suggestions');
                    container.innerHTML = '<h2>ğŸ“‹ SugestÃµes Carregadas:</h2>';
                    
                    data.suggestions.forEach(suggestion => {
                        const div = document.createElement('div');
                        div.className = 'suggestion';
                        div.innerHTML = `
                            <h3>${suggestion.type.toUpperCase()}: ${suggestion.title}</h3>
                            <p><strong>Prioridade:</strong> ${suggestion.priority}</p>
                            <p><strong>DetecÃ§Ã£o:</strong> ${suggestion.detection_description.substring(0, 100)}...</p>
                            <button onclick="applySuggestion('${suggestion.id}')">âœ… Aplicar</button>
                            <button onclick="previewSuggestion('${suggestion.id}')">ğŸ‘ï¸ Preview</button>
                        `;
                        container.appendChild(div);
                    });
                    
                    addResult(`âœ… ${data.suggestions.length} sugestÃµes carregadas com sucesso!`, true);
                } else {
                    addResult('âŒ Falha ao carregar sugestÃµes', false);
                }
            } catch (error) {
                addResult(`âŒ Erro: ${error.message}`, false);
            }
        }
        
        async function testApply() {
            addResult('ğŸ§ª Testando aplicaÃ§Ã£o de sugestÃ£o...');
            
            try {
                const response = await fetch('http://localhost:8001/evolution/apply', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        suggestion_id: 'perf-opt-001',
                        approved: true,
                        approver: 'test_user'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addResult(`âœ… Teste de aplicaÃ§Ã£o bem-sucedido: ${result.message}`, true);
                } else {
                    addResult(`âŒ Falha no teste de aplicaÃ§Ã£o: ${result.message}`, false);
                }
            } catch (error) {
                addResult(`âŒ Erro no teste: ${error.message}`, false);
            }
        }
        
        async function testPreview() {
            addResult('ğŸ‘ï¸ Testando preview de cÃ³digo...');
            
            try {
                const response = await fetch('http://localhost:8001/evolution/preview/perf-opt-001');
                const data = await response.json();
                
                if (data.success) {
                    addResult('âœ… Preview carregado com sucesso!', true);
                    addResult(`ğŸ“ CÃ³digo tem ${data.code.length} caracteres`, true);
                } else {
                    addResult(`âŒ Falha no preview: ${data.error}`, false);
                }
            } catch (error) {
                addResult(`âŒ Erro no preview: ${error.message}`, false);
            }
        }
        
        async function applySuggestion(id) {
            addResult(`ğŸ”„ Aplicando sugestÃ£o ${id}...`);
            
            try {
                const response = await fetch('http://localhost:8001/evolution/apply', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        suggestion_id: id,
                        approved: true,
                        approver: 'test_interface'
                    })
                });
                
                const result = await response.json();
                addResult(`âœ… ${result.message}`, result.success);
            } catch (error) {
                addResult(`âŒ Erro: ${error.message}`, false);
            }
        }
        
        async function previewSuggestion(id) {
            addResult(`ğŸ‘ï¸ Carregando preview de ${id}...`);
            
            try {
                const response = await fetch(`http://localhost:8001/evolution/preview/${id}`);
                const data = await response.json();
                
                if (data.success) {
                    alert(`Preview de ${id}:\n\n${data.code.substring(0, 500)}...`);
                    addResult('âœ… Preview exibido!', true);
                } else {
                    addResult(`âŒ Erro no preview: ${data.error}`, false);
                }
            } catch (error) {
                addResult(`âŒ Erro: ${error.message}`, false);
            }
        }
        
        // Teste automÃ¡tico ao carregar
        window.onload = function() {
            addResult('ğŸš€ PÃ¡gina de teste carregada');
            addResult('ğŸ’¡ Clique em "Testar ConexÃ£o API" para verificar se a API estÃ¡ funcionando');
        };
    </script>
</body>
</html> 